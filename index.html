<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>干燥综合征健康管理</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <!-- 登录页 -->
        <div id="login-page" class="page active">
            <div class="login-container">
                <div class="logo-section">
                    <div class="logo">SS</div>
                    <h1>干燥综合征健康管理</h1>
                    <p>个人数据采集工具</p>
                </div>
                <div class="form-section">
                    <div class="input-group">
                        <label>用户名</label>
                        <input type="text" id="username-input" placeholder="请输入用户名">
                    </div>
                    <div class="input-group">
                        <label>密码</label>
                        <input type="password" id="password-input" placeholder="请输入密码">
                    </div>
                    <button class="btn-primary" onclick="handleLogin()">进入系统</button>
                </div>
            </div>
        </div>

        <!-- 患者列表页 -->
        <div id="patient-list-page" class="page">
            <header>
                <h2>患者列表</h2>
                <span class="logout" onclick="handleLogout()">退出</span>
            </header>
            <div class="search-section">
                <input type="text" id="search-input" placeholder="搜索住院号/姓名..." oninput="searchPatients()">
            </div>
            <div class="filter-section">
                <button class="filter-btn active" onclick="filterPatients('all')">全部</button>
                <button class="filter-btn" onclick="filterPatients('not-started')">未开始</button>
                <button class="filter-btn" onclick="filterPatients('in-progress')">进行中</button>
                <button class="filter-btn" onclick="filterPatients('completed')">已完成</button>
                <button class="filter-btn" onclick="filterPatients('excluded')">已剔除</button>
            </div>
            <div class="patient-list" id="patient-list"></div>
            <div class="add-patient-section">
                <button class="btn-add" onclick="showAddPatient()">+ 添加患者</button>
                <button class="btn-export-all" onclick="exportAllPatients()">📤 导出全部数据</button>
            </div>
        </div>

        <!-- 添加患者弹窗 -->
        <div id="add-patient-modal" class="modal">
            <div class="modal-content">
                <h3>添加新患者</h3>
                <div class="input-group">
                    <label>住院号 *</label>
                    <input type="text" id="new-patient-id" placeholder="请输入住院号">
                </div>
                <div class="input-group">
                    <label>姓名 *</label>
                    <input type="text" id="new-patient-name" placeholder="请输入姓名">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="hideAddPatient()">取消</button>
                    <button class="btn-confirm" onclick="goToScreening()">下一步：纳排筛查</button>
                </div>
            </div>
        </div>

        <!-- 纳入排除筛查弹窗 -->
        <div id="screening-modal" class="modal">
            <div class="modal-content modal-large">
                <h3>纳入排除标准筛查</h3>
                <p class="screening-hint">请根据患者情况勾选以下条件：</p>
                
                <div class="screening-section">
                    <div class="screening-title inclusion">✓ 纳入标准（需全部满足）</div>
                    <label class="screening-item"><input type="checkbox" id="inc1"> 2014-2024年在中大医院首次确诊原发性干燥综合征</label>
                    <label class="screening-item"><input type="checkbox" id="inc2"> 符合2016 ACR/EULAR分类标准</label>
                    <label class="screening-item"><input type="checkbox" id="inc3"> 有较完整的电子病历记录</label>
                    <label class="screening-item"><input type="checkbox" id="inc4"> 至少有一次随访记录</label>
                    <label class="screening-item"><input type="checkbox" id="inc5"> 有中医四诊资料</label>
                </div>
                
                <div class="screening-section">
                    <div class="screening-title exclusion">✗ 排除标准（任一符合则排除）</div>
                    <label class="screening-item"><input type="checkbox" id="exc1"> 继发性干燥综合征（合并RA、SLE、SSc等）</label>
                    <label class="screening-item"><input type="checkbox" id="exc2"> 严重恶性肿瘤晚期</label>
                    <label class="screening-item"><input type="checkbox" id="exc3"> 关键研究变量严重缺失</label>
                    <label class="screening-item"><input type="checkbox" id="exc4"> 中医四诊资料严重缺失</label>
                </div>
                
                <div class="screening-result" id="screening-result"></div>
                
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="backToAddPatient()">返回</button>
                    <button class="btn-confirm" id="screening-confirm-btn" onclick="confirmScreening()">确认添加</button>
                </div>
            </div>
        </div>

        <!-- 剔除患者弹窗 -->
        <div id="exclude-patient-modal" class="modal">
            <div class="modal-content">
                <h3>剔除患者</h3>
                <p style="color:#6b7280;font-size:14px;margin-bottom:16px;">请选择剔除原因：</p>
                <div class="exclude-reasons">
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="继发性干燥综合征"> 继发性干燥综合征</label>
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="合并严重恶性肿瘤"> 合并严重恶性肿瘤</label>
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="关键变量严重缺失"> 关键变量严重缺失</label>
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="中医四诊资料缺失"> 中医四诊资料缺失</label>
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="数据录入错误"> 数据录入错误</label>
                    <label class="exclude-option"><input type="radio" name="exclude-reason" value="other"> 其他原因</label>
                </div>
                <div class="input-group" id="other-reason-group" style="display:none;margin-top:12px;">
                    <input type="text" id="other-reason-input" placeholder="请输入其他原因">
                </div>
                <div class="modal-buttons">
                    <button class="btn-cancel" onclick="hideExcludeModal()">取消</button>
                    <button class="btn-confirm" style="background:linear-gradient(135deg,#ef4444,#f87171);" onclick="confirmExclude()">确认剔除</button>
                </div>
            </div>
        </div>

        <!-- 患者详情页 -->
        <div id="patient-detail-page" class="page">
            <header>
                <span class="back" onclick="backToList()">&lt; 返回</span>
                <h2 id="patient-name-title">患者详情</h2>
                <span class="exclude-btn" onclick="showExcludeModal()">剔除</span>
            </header>
            <div class="patient-overview" id="patient-overview"></div>
            <div class="progress-section">
                <h3>数据采集进度</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                <span class="progress-text" id="progress-text">0/13</span>
            </div>
            <div class="module-grid" id="module-list"></div>
            <div class="export-section">
                <button class="btn-export" onclick="exportPatientData()">导出该患者数据</button>
                <button class="btn-delete" id="delete-btn" onclick="deletePatient()">🗑️ 永久删除患者</button>
            </div>
        </div>

        <!-- 表单页 -->
        <div id="form-page" class="page">
            <header>
                <span class="back" onclick="backToDetail()">&lt; 返回</span>
                <h2 id="form-title">表单</h2>
                <span class="save" onclick="saveForm()">保存</span>
            </header>
            <div class="form-container" id="form-container"></div>
        </div>
    </div>
    <script src="js/data.js"></script>
    <script src="js/data2.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
